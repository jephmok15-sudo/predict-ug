<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Predict UG</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;800&display=swap" rel="stylesheet">

  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

  <style>
    body{
      margin:0;
      background:#000;
      font-family: 'Montserrat', sans-serif;
      color:#fff;
    }
    header{
      background:#000;
      padding:15px;
      text-align:center;
      font-size:26px;
      font-weight:800;
      color:#e50914;
      border-bottom:2px solid #111;
    }
    .container{
      max-width:1000px;
      margin:auto;
      padding:20px;
    }
    .card{
      background:#111;
      padding:20px;
      border-radius:12px;
      margin-bottom:20px;
    }
    h2{margin-top:0;color:#e50914;}

    input,button,select{
      width:100%;
      padding:12px;
      margin-top:10px;
      margin-bottom:15px;
      border-radius:6px;
      border:none;
      font-size:14px;
    }
    button{background:#e50914;color:#fff;font-weight:700;}
    button:active{opacity:0.8}

    .hidden{display:none;}

    .prediction{
      background:#000;
      border:1px solid #333;
      padding:10px;
      border-radius:8px;
      margin:10px 0;
    }

    .nav{
      display:flex;
      justify-content:space-between;
      margin-top:10px;
    }
  </style>
</head>
<body>

<header>Predict UG</header>

<div class="container">

  <!-- AUTH -->
  <div id="authCard" class="card">
    <h2>Login / Register</h2>
    <input id="email" placeholder="Email">
    <input id="password" type="password" placeholder="Password">
    <button onclick="login()">Login</button>
    <button onclick="register()">Register</button>
  </div>

  <!-- DASHBOARD -->
  <div id="dashboard" class="hidden">

    <div class="card">
      <h2>Your Profile</h2>
      <p><b>Email:</b> <span id="userEmail"></span></p>
      <p><b>Points:</b> <span id="userPoints">0</span></p>
      <button onclick="logout()">Logout</button>
    </div>

    <div class="card">
      <h2>Available Predictions</h2>
      <div id="predictionsList"></div>
    </div>

  </div>

</div>

<script>
  // ðŸ”¥ Firebase Configuration (YOUR DETAILS)
  const firebaseConfig = {
    apiKey: "AIzaSyBnIeC8g8sx0KxKgoHQNqRlT3u3EVYA_10",
    authDomain: "predict-ug.firebaseapp.com",
    databaseURL: "https://predict-ug-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "predict-ug",
    storageBucket: "predict-ug.firebasestorage.app",
    messagingSenderId: "904307610384",
    appId: "1:904307610384:web:588965a0949648ff89cb95",
    measurementId: "G-4343P0JB6N"
  };

  firebase.initializeApp(firebaseConfig);

  const auth = firebase.auth();
  const db = firebase.database();

  const authCard = document.getElementById('authCard');
  const dashboard = document.getElementById('dashboard');

  // REGISTER
  function register(){
    const email = email.value;
    const password = password.value;

    auth.createUserWithEmailAndPassword(email,password)
    .then(res=>{
      db.ref("users/"+res.user.uid).set({
        email:email,
        points:0
      })
    })
    .catch(e=>alert(e.message))
  }

  // LOGIN
  function login(){
    auth.signInWithEmailAndPassword(email.value,password.value)
    .catch(e=>alert(e.message))
  }

  function logout(){
    auth.signOut();
  }

  // AUTH STATE
  auth.onAuthStateChanged(user=>{
    if(user){
      authCard.classList.add("hidden");
      dashboard.classList.remove("hidden");
      document.getElementById("userEmail").innerText = user.email;

      // Load points
      db.ref("users/"+user.uid+"/points").on("value", s=>{
        document.getElementById("userPoints").innerText = s.val() || 0;
      })

      loadPredictions();
    } else {
      authCard.classList.remove("hidden");
      dashboard.classList.add("hidden");
    }
  })

  // LOAD PREDICTIONS
  function loadPredictions(){
    const list = document.getElementById("predictionsList");
    list.innerHTML="Loading...";

    db.ref("predictions").on("value", snap=>{
      list.innerHTML = "";

      snap.forEach(child=>{
        const pred = child.val();

        const div = document.createElement("div");
        div.className="prediction";

        div.innerHTML = `
          <b>${pred.title}</b>
          <p>${pred.description}</p>
          <p>Options: ${pred.options}</p>

          <select id="points_${child.key}">
            <option value="5">5 Points</option>
            <option value="10">10 Points</option>
            <option value="20">20 Points</option>
            <option value="50">50 Points</option>
          </select>

          <button onclick="placePrediction('${child.key}')">Submit Prediction</button>
        `

        list.appendChild(div);
      })
    })
  }

  // PLACE PREDICTION
  function placePrediction(predictionId){
    const user = auth.currentUser;
    if(!user) return;

    const pts = document.getElementById("points_"+predictionId).value;

    db.ref("user_predictions/"+user.uid+"/"+predictionId).set({
      points: pts,
      time: Date.now()
    })

    alert("Prediction sent successfully âœ…")
  }

</script>
</body>
</html>
