<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Predict UG â€” Smart predictions</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">
<style>
  :root{--bg:#000;--card:#0f0f0f;--muted:#828282;--accent:#e50914;--white:#fff;--radius:12px}
  *{box-sizing:border-box}
  body{margin:0;font-family:Poppins,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial; background:var(--bg); color:var(--white)}
  header{padding:28px 16px;text-align:center;border-bottom:1px solid #111}
  header h1{margin:0;color:var(--accent);font-size:34px}
  header p{margin:6px 0 0;color:var(--muted)}
  .container{max-width:980px;margin:20px auto;padding:0 16px}
  .card{background:var(--card);border-radius:var(--radius);padding:18px;margin-bottom:16px;box-shadow:0 6px 18px rgba(0,0,0,.6)}
  .main-grid{display:block}
  @media(min-width:900px){.main-grid{display:grid;grid-template-columns:1fr 360px;gap:18px}}
  h2{margin:0 0 12px;font-size:20px}
  .loader{color:var(--muted);padding:20px;text-align:center}
  .prediction{background:#0b0b0b;padding:14px;border-radius:10px;margin-bottom:12px}
  .prediction h3{margin:0;color:var(--accent)}
  .odds{display:inline-block;padding:6px 10px;border-radius:8px;background:#111;margin-top:10px}
  .btn{display:inline-block;padding:10px 14px;border-radius:10px;background:var(--accent);color:var(--white);text-decoration:none}
  input,textarea,select{width:100%;padding:10px;border-radius:8px;border:1px solid #222;background:#070707;color:var(--white)}
  .two{display:flex;gap:10px}
  .two> *{flex:1}
  footer{padding:18px 0;text-align:center;color:var(--muted);font-size:14px}
  /* age gate */
  #ageGate{position:fixed;inset:0;background:rgba(0,0,0,.9);display:flex;align-items:center;justify-content:center;z-index:9999}
  #ageGate .box{background:#090909;padding:26px;border-radius:14px;text-align:center;max-width:420px}
  a.inline{color:var(--accent);text-decoration:underline}
</style>
</head>
<body>

<header>
  <h1>Predict UG âœ…</h1>
  <p>Smart football predictions & betting tips platform â€” predictions only, no direct betting.</p>
</header>

<div class="container">

  <!-- AUTH & USER CARD -->
  <div class="card" id="authCard">
    <div id="signedOutUI">
      <h2>Sign in or Register</h2>
      <div class="two" style="margin-top:10px">
        <input id="email" placeholder="Email" type="email" />
        <input id="password" placeholder="Password" type="password" />
      </div>
      <div style="margin-top:10px;display:flex;gap:10px">
        <button id="btnSignIn" class="btn" style="background:#0a74ff">Sign in</button>
        <button id="btnRegister" class="btn" style="background:#10b981">Register</button>
      </div>
      <p style="color:var(--muted);margin-top:10px">Register to track points, earnings and access member features. You remain responsible for funds used on affiliate sites.</p>
    </div>

    <div id="signedInUI" style="display:none">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div>
          <strong id="userEmail">you@example.com</strong>
          <div id="userPoints" style="color:var(--muted);font-size:14px">Points: 0 â€¢ Earnings: UGX 0</div>
        </div>
        <div>
          <button id="btnSignOut" class="btn" style="background:#444">Sign out</button>
        </div>
      </div>
    </div>
  </div>

  <div class="main-grid">
    <main>

      <div class="card" id="topAdBox">Loading ad...</div>

      <div class="card">
        <h2>ðŸ”¥ Latest Predictions</h2>
        <div id="predictionsList"><div class="loader">Loading predictions from admin panel...</div></div>
      </div>

      <div class="card" id="paymentCard">
        <h2>Payments & Support</h2>
        <p style="color:var(--muted)">We don't hold funds. Use affiliate partner links to place bets or support the site via Stripe.</p>
        <div style="margin-top:10px">
          <button id="btnStripePay" class="btn">Support via Card (Stripe)</button>
        </div>
        <p style="color:var(--muted);margin-top:10px">Stripe requires a server endpoint to create a Checkout session (setup instructions below).</p>
      </div>

    </main>

    <aside>
      <div class="card">
        <h2>Quick Stats</h2>
        <p id="statsUsers">Users: â€”</p>
        <p id="statsPoints">Total Points: â€”</p>
        <p id="statsEarnings">Total Earnings: UGX â€”</p>
      </div>

      <div class="card">
        <h2>Affiliate</h2>
        <div id="affiliateContent">Loading affiliate info...</div>
      </div>
    </aside>
  </div>

</div>

<footer>
  Predict UG Â© 2025 | We provide predictions only, no direct betting. <a href="#terms" class="inline" id="btnTos">Terms</a>
</footer>

<!-- AGE GATE -->
<div id="ageGate" style="display:none">
  <div class="box">
    <h3>Age verification</h3>
    <p style="color:var(--muted)">You must be 18+ to view this site. By continuing you confirm you are 18+ and agree to our <a id="tosLink" class="inline">Terms & Privacy</a>.</p>
    <div style="margin-top:12px">
      <button id="btnIm18" class="btn">I am 18+</button>
      <button id="btnLeave" style="margin-left:10px;padding:10px 14px;border-radius:10px;background:#333;color:#fff;border:none">Leave</button>
    </div>
  </div>
</div>

<!-- TOS (hidden content) -->
<div id="terms" style="display:none">
  <h2>Terms & Conditions (Preview)</h2>
  <p>Predict UG provides prediction tips for entertainment. We are not a betting operator. Users follow affiliate links at their own risk.</p>
</div>

<!-- Firebase v8 -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

<script>
/* ==========================
   CONFIG - Put your Firebase config here (same as admin)
   ========================== */
const firebaseConfig = {
  apiKey: "AIzaSyBnIeC8g8sx0KxKgoHQNqRlT3u3EVYA_10",
  authDomain: "predict-ug.firebaseapp.com",
  databaseURL: "https://predict-ug-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "predict-ug",
  storageBucket: "predict-ug.firebasestorage.app",
  messagingSenderId: "904307610384",
  appId: "1:904307610384:web:588965a0949648ff89cb95"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.database();

/* REFS */
const predictionsRef = db.ref('predictions');
const adsRef = db.ref('adsAffiliate');
const usersRef = db.ref('users');

/* UI refs */
const ageGate = document.getElementById('ageGate');
const btnIm18 = document.getElementById('btnIm18');
const btnLeave = document.getElementById('btnLeave');
const btnTos = document.getElementById('btnTos');
const btnStripePay = document.getElementById('btnStripePay');

const signedOutUI = document.getElementById('signedOutUI');
const signedInUI = document.getElementById('signedInUI');
const emailInput = document.getElementById('email');
const passInput = document.getElementById('password');
const btnSignIn = document.getElementById('btnSignIn');
const btnRegister = document.getElementById('btnRegister');
const btnSignOut = document.getElementById('btnSignOut');

const userEmailEl = document.getElementById('userEmail');
const userPointsEl = document.getElementById('userPoints');

const predictionsList = document.getElementById('predictionsList');
const topAdBox = document.getElementById('topAdBox');
const affiliateContent = document.getElementById('affiliateContent');
const statsUsers = document.getElementById('statsUsers');
const statsPoints = document.getElementById('statsPoints');
const statsEarnings = document.getElementById('statsEarnings');

/* AGE gate logic */
if(!localStorage.getItem('pred_age_ok')){
  ageGate.style.display = 'flex';
}
btnIm18.onclick = () => { localStorage.setItem('pred_age_ok','1'); ageGate.style.display='none'; }
btnLeave.onclick = () => { window.location.href = 'https://google.com'; }

/* AUTH */
btnSignIn.addEventListener('click', ()=> {
  const email = emailInput.value.trim(), password = passInput.value;
  if(!email || !password) return alert('Please enter email and password');
  auth.signInWithEmailAndPassword(email,password).catch(e=>alert('Sign in error: '+e.message));
});
btnRegister.addEventListener('click', ()=> {
  const email = emailInput.value.trim(), password = passInput.value;
  if(!email || !password) return alert('Please enter email and password');
  auth.createUserWithEmailAndPassword(email,password)
    .then(({user}) => usersRef.child(user.uid).set({email:user.email,points:0,earnings:0}))
    .catch(e=>alert('Register error: '+e.message));
});
btnSignOut.addEventListener('click', ()=> auth.signOut());

auth.onAuthStateChanged(user => {
  if(user){
    signedInUI.style.display = '';
    signedOutUI.style.display = 'none';
    userEmailEl.textContent = user.email;
    usersRef.child(user.uid).once('value').then(snap=>{
      const d = snap.val()||{};
      userPointsEl.textContent = `Points: ${d.points||0} â€¢ Earnings: UGX ${d.earnings||0}`;
    });
  } else {
    signedInUI.style.display = 'none';
    signedOutUI.style.display = '';
    userEmailEl.textContent = '';
    userPointsEl.textContent = '';
  }
});

/* LOAD PREDICTIONS */
function renderPredictions(data){
  if(!data){ predictionsList.innerHTML = '<div class="loader">No predictions yet.</div>'; return; }
  const items = Object.entries(data).sort((a,b)=> (b[1].created||0) - (a[1].created||0));
  predictionsList.innerHTML = '';
  items.forEach(([key,item])=>{
    const div = document.createElement('div');
    div.className = 'prediction';
    div.innerHTML = `<h3>${escape(item.match||'Untitled')}</h3><div class="odds">Odds: ${escape(item.odds||'â€”')}</div><p>${escape(item.details||'')}</p>${ item.affiliateLink ? `<a class="btn" target="_blank" href="${encodeURI(item.affiliateLink)}">BET HERE</a>` : '' }`;
    predictionsList.appendChild(div);
  });
}
predictionsRef.on('value', snap => renderPredictions(snap.val()));

/* LOAD ADS/AFFILIATE */
adsRef.on('value', snap=>{
  const data = snap.val();
  if(!data){ topAdBox.innerHTML = "<p style='color:var(--muted)'>No ad yet (set in admin panel)</p>"; affiliateContent.innerHTML="<p style='color:var(--muted)'>No affiliate set</p>"; return; }
  if(data.topAdHtml) topAdBox.innerHTML = data.topAdHtml;
  else topAdBox.innerHTML = `<h3 style="margin:0">${escape(data.affiliateName||'Partner')}</h3><a class="btn" target="_blank" href="${encodeURI(data.affiliateLink||'#')}">Join & Bet</a>`;
  affiliateContent.innerHTML = `<strong>${escape(data.affiliateName||'Partner')}</strong><p style="color:var(--muted)">${escape(data.affiliateDesc||'')}</p><a class="btn" target="_blank" href="${encodeURI(data.affiliateLink||'#')}">Go to Partner</a>`;
});

/* STATS aggregation */
function recalc(){
  usersRef.once('value').then(snap=>{
    const d = snap.val()||{};
    const arr = Object.values(d);
    statsUsers.textContent = 'Users: ' + arr.length;
    statsPoints.textContent = 'Total Points: ' + arr.reduce((s,u)=>s+(Number(u.points)||0),0);
    statsEarnings.textContent = 'Total Earnings: UGX ' + arr.reduce((s,u)=>s+(Number(u.earnings)||0),0);
  });
}
recalc();
usersRef.on('value', recalc);

/* STRIPE button - opens serverless function */
btnStripePay.addEventListener('click', ()=> {
  // Replace /api/create-checkout-session with your deployed serverless URL on Vercel
  const url = '/api/create-checkout-session'; // Vercel will proxy local if function exists
  window.open(url, '_blank');
});

/* simple helpers */
function escape(s){ return (s||'').toString().replace(/[&<>"']/g, m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }
</script>
</body>
</html>
